# VECTRA-PLAYER Process Flowcharts

**Version:** 1.0.0  
**Date:** December 29, 2025  
**Purpose:** ASCII flowchart documentation of all major codebase processes

---

## Table of Contents

1. [Application Lifecycle](#1-application-lifecycle)
2. [Event-Driven Architecture](#2-event-driven-architecture)
3. [Data Flow Pipeline](#3-data-flow-pipeline)
4. [Live vs Replay Mode](#4-live-vs-replay-mode)
5. [Browser Automation (CDP)](#5-browser-automation-cdp)
6. [Trading & Action Flow](#6-trading--action-flow)
7. [State Management](#7-state-management)
8. [Vector Indexing & RAG](#8-vector-indexing--rag)
9. [Testing & CI/CD](#9-testing--cicd)

---

## 1. Application Lifecycle

### 1.1 Main Application Startup Flow

```
┌─────────────────────────────────────────────────────────────┐
│                    main.py: main()                          │
│                         ▼                                    │
│         Parse CLI args (--live flag)                        │
└────────────────────────┬────────────────────────────────────┘
                         ▼
┌─────────────────────────────────────────────────────────────┐
│         Application.__init__(live_mode=args.live)           │
├─────────────────────────────────────────────────────────────┤
│  1. Setup logging (setup_logging())                         │
│  2. Initialize config (config.validate())                   │
│  3. Create GameState(initial_balance, event_bus)            │
│  4. Start EventBus (event_bus.start())                      │
│  5. Start AsyncLoopManager (async_manager.start())          │
│  6. Setup event handlers (_setup_event_handlers())          │
│  7. Create Tk root window                                   │
│  8. Configure root window (_configure_root())               │
└────────────────────────┬────────────────────────────────────┘
                         ▼
┌─────────────────────────────────────────────────────────────┐
│                  Application.run()                          │
├─────────────────────────────────────────────────────────────┤
│  1. Create BrowserBridge (get_browser_bridge())             │
│  2. Create LiveStateProvider(event_bus)                     │
│  3. Create & Start EventStoreService(event_bus)             │
│  4. Create MinimalWindow(root, state, event_bus, ...)       │
│  5. Auto-load games (if not live_mode)                      │
│  6. Publish UI_READY event                                  │
│  7. Start Tk mainloop (root.mainloop())                     │
└────────────────────────┬────────────────────────────────────┘
                         ▼
         ┌───────────────────────────────────┐
         │   Application Running             │
         │   (Tkinter event loop active)     │
         └───────────────┬───────────────────┘
                         ▼
┌─────────────────────────────────────────────────────────────┐
│            User Closes Window / Ctrl+C                      │
└────────────────────────┬────────────────────────────────────┘
                         ▼
┌─────────────────────────────────────────────────────────────┐
│               Application.shutdown()                        │
├─────────────────────────────────────────────────────────────┤
│  1. Set shutdown timeout (10s alarm)                        │
│  2. Save config to file                                     │
│  3. Calculate & log final metrics                           │
│  4. Stop EventStore (flushes buffers)                       │
│  5. Stop LiveStateProvider                                  │
│  6. Stop BrowserBridge                                      │
│  7. Stop EventBus                                           │
│  8. Cleanup MainWindow (unsubscribe events)                 │
│  9. Stop AsyncLoopManager                                   │
│  10. Quit & Destroy Tk root                                 │
│  11. Exit cleanly (sys.exit(0))                             │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 Component Initialization Order

```
         Startup Order (Critical Dependencies)
         =====================================

    1. Logging
       └─→ All components need logger

    2. Config
       └─→ Validated early, used by all

    3. GameState
       └─→ Core state container

    4. EventBus
       └─→ Communication backbone
          │
          ├─→ 5. EventStoreService
          │      └─→ Subscribes to events
          │
          ├─→ 6. LiveStateProvider
          │      └─→ Subscribes to WS events
          │
          ├─→ 7. BrowserBridge
          │      └─→ Publishes WS events
          │
          └─→ 8. MinimalWindow (UI)
                 └─→ Subscribes & publishes

    9. AsyncLoopManager
       └─→ Handles async operations from Tk thread

    10. Tkinter mainloop()
        └─→ Blocks until app closes
```
